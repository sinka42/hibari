;/*FB_PKG_DELIM*/

__d("LSSetBotResponseInfo",["LSArrayGetObjectAt","LSDeserializeFromJsonIntoDictionaryV2.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(n){return t.filter(t.db.table(12).fetch([[[e[1]]],"messageId"]),function(n){return t.i64.eq(n.threadKey,e[0])&&n.messageId===e[1]}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[0]=void 0:(t=o.item,r[0]=t.metadataDataclass)})},function(o){return r[0]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSDeserializeFromJsonIntoDictionaryV2.nop"),r[0]).then(function(e){var t;return t=e,r[2]=t[0],t})},function(e){return r[3]=new t.Map,r[4]=r[2].keys(),r[5]=t.i64.of_int32(r[4].length),t.i64.gt(r[5],t.i64.cast([0,0]))?t.loopAsync(r[5],function(e){return r[6]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[4],r[6]).then(function(e){var t;return t=e,r[7]=t[0],r[8]=t[1],t})},function(e){return r[9]=r[2].get(r[7]),r[3].set(r[7],r[9])}])}):t.resolve()},function(o){return e[3]!==void 0?t.sequence([function(o){return t.nativeOperation(n("LSDeserializeFromJsonIntoDictionaryV2.nop"),e[3]).then(function(e){var t;return t=e,r[6]=t[0],t})},function(e){return r[7]=new t.Map,r[8]=r[6].keys(),r[9]=t.i64.of_int32(r[8].length),t.i64.gt(r[9],t.i64.cast([0,0]))?t.loopAsync(r[9],function(e){return r[14]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[8],r[14]).then(function(e){var t;return t=e,r[15]=t[0],r[16]=t[1],t})},function(e){return r[17]=r[6].get(r[15]),r[7].set(r[15],r[17])}])}):t.resolve()},function(e){return r[10]=r[7].get("ai_bot"),r[10]?r[11]=!1:r[11]=!0,r[11]?t.resolve(r[12]=void 0):t.sequence([function(e){return r[14]=new t.Map,r[15]=r[10].keys(),r[16]=t.i64.of_int32(r[15].length),t.i64.gt(r[16],t.i64.cast([0,0]))?t.loopAsync(r[16],function(e){return r[17]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[15],r[17]).then(function(e){var t;return t=e,r[18]=t[0],r[19]=t[1],t})},function(e){return r[20]=r[10].get(r[18]),r[14].set(r[18],r[20])}])}):t.resolve()},function(e){return r[12]=r[14]}])},function(n){return r[3].set("ai_bot",r[12]),r[13]=t.toJSON(r[3]),t.forEach(t.filter(t.db.table(12).fetch([[[e[1]]],"messageId"]),function(n){return t.i64.eq(n.threadKey,e[0])&&n.messageId===e[1]}),function(t){var n=t.update,o=t.item;return n({botResponseId:e[2],metadataDataclass:r[13]})})}]):t.forEach(t.filter(t.db.table(12).fetch([[[e[1]]],"messageId"]),function(n){return t.i64.eq(n.threadKey,e[0])&&n.messageId===e[1]}),function(t){var n=t.update,r=t.item;return n({botResponseId:e[2]})})}]):t.forEach(t.filter(t.db.table(12).fetch([[[e[1]]],"messageId"]),function(n){return t.i64.eq(n.threadKey,e[0])&&n.messageId===e[1]}),function(t){var n=t.update,r=t.item;return n({botResponseId:e[2],metadataDataclass:e[3]})})}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxSetBotResponseInfoStoredProcedure",e.__tables__=["messages"],a.exports=e}),null);